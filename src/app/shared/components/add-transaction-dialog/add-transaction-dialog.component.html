<app-base-dialog
  [title]="isEdit ? 'Editar Transação' : 'Adicionar Gasto'"
  [subtitle]="compactMode ? 'Adicione rapidamente um novo gasto' : 'Preencha as informações da transação'"
  icon="account_balance_wallet"
  [compact]="compactMode"
  [loading]="loading"
  [loadingMessage]="loading ? 'Salvando transação...' : ''"
  [showDefaultActions]="true"
  [confirmLabel]="isEdit ? 'Atualizar' : 'Adicionar'"
  [confirmIcon]="isEdit ? 'save' : 'add'"
  [confirmDisabled]="isButtonDisabled"
  (confirmed)="onSave()"
  (cancelled)="onCancel()"
  (closed)="onCancel()">

  <!-- Form -->
  <form [formGroup]="transactionForm" (ngSubmit)="onSave()" class="transaction-form">
    
    <!-- Seletor de Tipo de Transação (Moderno) -->
    <div class="transaction-type-selector">
      <div class="type-toggle-container">
        <button type="button" 
                class="type-button expense-button"
                [class.active]="transactionForm.get('transactionType')?.value === 'expense'"
                (click)="transactionForm.patchValue({transactionType: 'expense'})">
          <mat-icon>trending_down</mat-icon>
          <span>Gasto</span>
        </button>
        
        <button type="button" 
                class="type-button income-button"
                [class.active]="transactionForm.get('transactionType')?.value === 'income'"
                (click)="transactionForm.patchValue({transactionType: 'income'})">
          <mat-icon>trending_up</mat-icon>
          <span>Receita</span>
        </button>
      </div>
    </div>
    
    <!-- Versão Compacta -->
    <div *ngIf="compactMode && !expanded" class="compact-form">
      <div class="compact-row">
        <app-form-input
          class="compact-field description-field"
          label="O que foi?"
          placeholder="Ex: Almoço"
          [maxLength]="100"
          [errorMessage]="getFieldError('description')"
          formControlName="description">
        </app-form-input>
        
        <app-form-input
          class="compact-field amount-field"
          label="Valor"
          type="number"
          placeholder="0,00"
          prefix="R$"
          [step]="0.01"
          [min]="0"
          [errorMessage]="getFieldError('amount')"
          formControlName="amount">
        </app-form-input>
      </div>

      <div class="compact-row">
        <app-form-input
          class="compact-field category-field"
          label="Categoria"
          type="select"
          [options]="categoryOptions"
          [errorMessage]="getFieldError('category')"
          formControlName="category">
        </app-form-input>

        <div class="compact-actions">
          <button type="button" mat-icon-button (click)="toggleExpanded()" 
                  matTooltip="Mais opções" class="expand-button">
            <mat-icon>expand_more</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- Versão Expandida -->
    <div *ngIf="!compactMode || expanded" class="expanded-form">
      
      <!-- Descrição -->
      <app-form-input
        class="full-width"
        label="Descrição"
        placeholder="Ex: Almoço no restaurante"
        hint="Descreva o que foi gasto"
        [maxLength]="100"
        [errorMessage]="getFieldError('description')"
        formControlName="description">
      </app-form-input>

      <!-- Valor e Data -->
      <div class="form-row">
        <app-form-input
          class="amount-field"
          label="Valor"
          type="number"
          placeholder="0,00"
          prefix="R$"
          hint="Valor gasto"
          [step]="0.01"
          [min]="0"
          [errorMessage]="getFieldError('amount')"
          formControlName="amount">
        </app-form-input>

        <app-form-input
          class="date-field"
          label="Data"
          type="date"
          hint="Data do gasto"
          [errorMessage]="getFieldError('date')"
          formControlName="date">
        </app-form-input>
      </div>

      <!-- Categoria -->
      <app-form-input
        class="full-width"
        label="Categoria"
        type="select"
        hint="Selecione uma categoria"
        [options]="categoryOptions"
        [errorMessage]="getFieldError('category')"
        formControlName="category">
      </app-form-input>

      <!-- Opções Adicionais -->
      <div class="additional-options">
        <mat-checkbox formControlName="isCreditCard" class="credit-card-checkbox">
          <mat-icon>credit_card</mat-icon>
          Pago com cartão de crédito
        </mat-checkbox>
      </div>

      <!-- Botão de colapsar (apenas no modo compacto) -->
      <div *ngIf="compactMode && expanded" class="collapse-section">
        <mat-divider></mat-divider>
        <button type="button" mat-button (click)="toggleExpanded()" class="collapse-button">
          <mat-icon>expand_less</mat-icon>
          Menos opções
        </button>
      </div>
    </div>

  </form>

</app-base-dialog>