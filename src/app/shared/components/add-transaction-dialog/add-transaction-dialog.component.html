<app-base-dialog
  [title]="isEdit ? 'Editar Transação' : 'Adicionar Gasto'"
  [subtitle]="compactMode ? 'Adicione rapidamente um novo gasto' : 'Preencha as informações da transação'"
  icon="account_balance_wallet"
  [compact]="compactMode"
  [loading]="loading"
  [loadingMessage]="loading ? 'Salvando transação...' : ''"
  [showDefaultActions]="true"
  [confirmLabel]="isEdit ? 'Atualizar' : 'Adicionar'"
  [confirmIcon]="isEdit ? 'save' : 'add'"
  [confirmDisabled]="transactionForm.invalid"
  (confirmed)="onSave()"
  (cancelled)="onCancel()"
  (closed)="onCancel()">

  <!-- Form -->
  <form [formGroup]="transactionForm" (ngSubmit)="onSave()" class="transaction-form">
    
    <!-- Versão Compacta -->
    <div *ngIf="compactMode && !expanded" class="compact-form">
      <div class="compact-row">
        <mat-form-field appearance="outline" class="compact-field description-field">
          <mat-label>O que foi?</mat-label>
          <input matInput formControlName="description" placeholder="Ex: Almoço" maxlength="100">
          <mat-error *ngIf="getFieldError('description')">{{ getFieldError('description') }}</mat-error>
        </mat-form-field>
        
        <mat-form-field appearance="outline" class="compact-field amount-field">
          <mat-label>Valor</mat-label>
          <input matInput type="number" formControlName="amount" 
                 (input)="onAmountChange($event)" 
                 placeholder="0,00" step="0.01" min="0">
          <span matPrefix>R$&nbsp;</span>
          <mat-error *ngIf="getFieldError('amount')">{{ getFieldError('amount') }}</mat-error>
        </mat-form-field>
      </div>

      <div class="compact-row">
        <mat-form-field appearance="outline" class="compact-field category-field">
          <mat-label>Categoria</mat-label>
          <mat-select formControlName="category">
            <mat-option *ngFor="let category of categories" [value]="category.name">
              <div class="category-option">
                <div class="category-color" [style.background-color]="category.color"></div>
                <span>{{ category.name }}</span>
              </div>
            </mat-option>
          </mat-select>
          <mat-error *ngIf="getFieldError('category')">{{ getFieldError('category') }}</mat-error>
        </mat-form-field>

        <div class="compact-actions">
          <button type="button" mat-icon-button (click)="toggleExpanded()" 
                  matTooltip="Mais opções" class="expand-button">
            <mat-icon>expand_more</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- Versão Expandida -->
    <div *ngIf="!compactMode || expanded" class="expanded-form">
      
      <!-- Descrição -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Descrição</mat-label>
        <input matInput formControlName="description" 
               placeholder="Ex: Almoço no restaurante" maxlength="100">
        <mat-hint>Descreva o que foi gasto</mat-hint>
        <mat-error *ngIf="getFieldError('description')">{{ getFieldError('description') }}</mat-error>
      </mat-form-field>

      <!-- Valor e Data -->
      <div class="form-row">
        <mat-form-field appearance="outline" class="amount-field">
          <mat-label>Valor</mat-label>
          <input matInput type="number" formControlName="amount" 
                 (input)="onAmountChange($event)" 
                 placeholder="0,00" step="0.01" min="0">
          <span matPrefix>R$&nbsp;</span>
          <mat-hint>Valor gasto</mat-hint>
          <mat-error *ngIf="getFieldError('amount')">{{ getFieldError('amount') }}</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="date-field">
          <mat-label>Data</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="date">
          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-hint>Data do gasto</mat-hint>
          <mat-error *ngIf="getFieldError('date')">{{ getFieldError('date') }}</mat-error>
        </mat-form-field>
      </div>

      <!-- Categoria -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Categoria</mat-label>
        <mat-select formControlName="category">
          <mat-option *ngFor="let category of categories" [value]="category.name">
            <div class="category-option">
              <div class="category-color" [style.background-color]="category.color"></div>
              <span>{{ category.name }}</span>
            </div>
          </mat-option>
        </mat-select>
        <mat-hint>Selecione uma categoria</mat-hint>
        <mat-error *ngIf="getFieldError('category')">{{ getFieldError('category') }}</mat-error>
      </mat-form-field>

      <!-- Opções Adicionais -->
      <div class="additional-options">
        <mat-checkbox formControlName="isCreditCard" class="credit-card-checkbox">
          <mat-icon>credit_card</mat-icon>
          Pago com cartão de crédito
        </mat-checkbox>
      </div>

      <!-- Botão de colapsar (apenas no modo compacto) -->
      <div *ngIf="compactMode && expanded" class="collapse-section">
        <mat-divider></mat-divider>
        <button type="button" mat-button (click)="toggleExpanded()" class="collapse-button">
          <mat-icon>expand_less</mat-icon>
          Menos opções
        </button>
      </div>
    </div>

  </form>

</app-base-dialog>