<div class="transaction-modal">
  <!-- Header -->
  <div class="modal-header">
    <div class="header-content">
      <mat-icon class="header-icon">account_balance_wallet</mat-icon>
      <div class="header-text">
        <h2 class="modal-title">{{ isEdit ? 'Editar Transação' : 'Adicionar Gasto' }}</h2>
        <p class="modal-subtitle">{{ compactMode ? 'Adicione rapidamente um novo gasto' : 'Preencha as informações da transação' }}</p>
      </div>
    </div>
    <button type="button" class="close-button" (click)="onCancel()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Form -->
  <form [formGroup]="transactionForm" (ngSubmit)="onSave($event)" class="transaction-form">
    
    <!-- Seletor de Tipo -->
    <div class="transaction-type-selector">
      <div class="type-toggle-container">
        <button type="button" 
                class="type-button expense-button"
                [class.active]="transactionForm.get('transactionType')?.value === 'expense'"
                (click)="transactionForm.patchValue({transactionType: 'expense'}); $event.stopPropagation()">
          <mat-icon>trending_down</mat-icon>
          <span>Gasto</span>
        </button>
        
        <button type="button" 
                class="type-button income-button"
                [class.active]="transactionForm.get('transactionType')?.value === 'income'"
                (click)="transactionForm.patchValue({transactionType: 'income'}); $event.stopPropagation()">
          <mat-icon>trending_up</mat-icon>
          <span>Receita</span>
        </button>
      </div>
    </div>

    <!-- Campos principais -->
    <div class="form-row">
      <app-form-input
        label="O que foi?"
        type="text"
        placeholder="Descreva a transação"
        [formControlName]="'description'"
        class="description-field">
      </app-form-input>
    </div>

    <div class="form-row">
      <app-form-input
        label="R$ Valor"
        type="number"
        placeholder="0,00"
        prefix="R$"
        [formControlName]="'amount'"
        class="amount-field">
      </app-form-input>
      
      <div class="category-field">
        <select 
          class="category-select"
          [formControlName]="'category'"
          required>
          <option value="" disabled>Selecione uma categoria</option>
          <option *ngFor="let option of categoryOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>
    </div>

    <div class="form-row">
      <div class="date-field">
        <div class="date-input-container">
          <label class="date-label">Data</label>
          <div class="date-input-wrapper">
            <!-- Input com máscara DD/MM -->
            <input 
              type="text"
              [formControlName]="'date'"
              placeholder="dd/mm"
              class="date-input-custom"
              (click)="toggleCustomDatePicker()"
              (focus)="onDateInputFocus()"
              (blur)="onDateInputBlur()"
              (input)="onDateInputChange($event)"
              #flatpickrInput>
            <mat-icon class="date-icon" (click)="toggleCustomDatePicker()">calendar_today</mat-icon>
            
            <!-- Datepicker customizado -->
            <div class="custom-datepicker" [class.show]="isCustomDatePickerOpen">
              <div class="datepicker-header">
                <button class="nav-button" (click)="previousMonth()">
                  <mat-icon>chevron_left</mat-icon>
                </button>
                <div class="month-year">
                  {{ currentMonthName }} {{ currentYear }}
                </div>
                <button class="nav-button" (click)="nextMonth()">
                  <mat-icon>chevron_right</mat-icon>
                </button>
              </div>
              
              <div class="datepicker-weekdays">
                <div class="weekday" *ngFor="let day of weekdays">{{ day }}</div>
              </div>
              
              <div class="datepicker-days">
                <div 
                  class="day" 
                  *ngFor="let day of calendarDays" 
                  [class.other-month]="!day.isCurrentMonth"
                  [class.today]="day.isToday"
                  [class.selected]="day.isSelected"
                  (click)="selectDate(day)"
                  [attr.data-day]="day.day">
                  {{ day.day }}
                </div>
              </div>
              
              <div class="datepicker-footer">
                <button class="footer-button" (click)="clearDate()">Limpar</button>
                <button class="footer-button" (click)="selectToday()">Hoje</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Cartão de Crédito -->
    <div class="form-row">
      <div class="credit-card-option">
        <mat-checkbox [formControlName]="'isCreditCard'" class="credit-card-checkbox">
          <mat-icon>credit_card</mat-icon>
          <span>Gasto no cartão de crédito</span>
        </mat-checkbox>
      </div>
    </div>

  </form>

  <!-- Actions -->
  <div class="modal-actions">
    <button type="button" class="cancel-button" (click)="onCancel()">
      Cancelar
    </button>
    <button type="button" 
            class="confirm-button" 
            [disabled]="!transactionForm.valid || loading"
            (click)="onSave()">
      <mat-icon *ngIf="!loading">{{ isEdit ? 'save' : 'add' }}</mat-icon>
      {{ loading ? 'Salvando...' : (isEdit ? 'Atualizar' : 'Adicionar') }}
    </button>
  </div>
</div>
