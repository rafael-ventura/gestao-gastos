<div class="informacoes-container">
  <!-- Header Modernizado -->
  <div class="informacoes-header">
    <div class="header-content">
      <mat-icon class="header-icon">analytics</mat-icon>
      <h1>Relatórios</h1>
      <p>Análise detalhada dos seus gastos e receitas</p>
    </div>
    
    <!-- Seletor de Mês Modernizado -->
    <div class="month-selector-container">
      <mat-form-field appearance="outline" class="month-selector">
        <mat-label>Período</mat-label>
        <mat-select [value]="selectedMonth" (selectionChange)="onMonthChange($event.value)">
          <mat-option *ngFor="let month of months" [value]="month">
            {{ formatMonthYear(month) }}
          </mat-option>
        </mat-select>
        <mat-icon matPrefix>calendar_today</mat-icon>
      </mat-form-field>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Carregando informações...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading" class="main-content">
    
    <!-- Empty State -->
    <div *ngIf="!hasData" class="empty-state">
      <mat-icon class="empty-icon">analytics</mat-icon>
      <h3>Nenhuma informação disponível</h3>
      <p>Adicione algumas transações para ver suas informações financeiras aqui.</p>
    </div>

    <!-- Content com Dados -->
    <div *ngIf="hasData" class="content-with-data">
      
      <!-- KPIs Principais - Layout Mosaico -->
      <div class="kpis-mosaic">
        <!-- Card Principal - Saldo (Destaque) -->
        <mat-card class="kpi-card kpi-main balance-card dark-card" [class]="getBalanceColor()">
          <mat-card-content>
            <div class="kpi-header">
              <h3>Saldo do Mês</h3>
              <mat-icon class="kpi-icon">{{ getBalanceIcon() }}</mat-icon>
            </div>
            <div class="kpi-value kpi-value-large">{{ formatCurrency(balance) }}</div>
            <div class="kpi-details">
              <span class="detail-item">
                <span class="label">Receitas:</span>
                <span class="value positive">{{ formatCurrency(income) }}</span>
              </span>
              <span class="detail-item">
                <span class="label">Gastos:</span>
                <span class="value negative">{{ formatCurrency(expenses) }}</span>
              </span>
            </div>
            
              <!-- GIFs Aleatórios -->
              <div class="gifs-container">
                <img [src]="randomGif1" alt="Decoração" class="money-gif">
                <img [src]="randomGif2" alt="Decoração" class="money-gif">
              </div>
          </mat-card-content>
        </mat-card>

        <!-- Cards Secundários -->
        <div class="kpis-secondary">
          <mat-card class="kpi-card kpi-small dark-card">
            <mat-card-content>
              <div class="kpi-header">
                <h3>Taxa de Poupança</h3>
                <mat-icon class="kpi-icon" [class]="getSavingsRateColor()">{{ getSavingsRateIcon() }}</mat-icon>
              </div>
              <div class="kpi-value" [class]="getSavingsRateColor()">{{ savingsRate | number:'1.1-1' }}%</div>
              <div class="kpi-details">
                <span class="detail-item">
                  <span class="label">Salário:</span>
                  <span class="value">{{ formatCurrency(salary) }}</span>
                </span>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="kpi-card kpi-small dark-card">
            <mat-card-content>
              <div class="kpi-header">
                <h3>Gasto Médio Diário</h3>
                <mat-icon class="kpi-icon">today</mat-icon>
              </div>
              <div class="kpi-value">{{ formatCurrency(averageDailyExpense) }}</div>
              <div class="kpi-details">
                <span class="detail-item">
                  <span class="label">Total do mês:</span>
                  <span class="value">{{ formatCurrency(expenses) }}</span>
                </span>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="kpi-card kpi-small dark-card">
            <mat-card-content>
              <div class="kpi-header">
                <h3>Cartão de Crédito</h3>
                <mat-icon class="kpi-icon">credit_card</mat-icon>
              </div>
              <div class="kpi-value">{{ formatCurrency(creditCardExpenses) }}</div>
              <div class="kpi-details">
                <span class="detail-item">
                  <span class="label">% do total:</span>
                  <span class="value">{{ (expenses > 0 ? (creditCardExpenses / expenses) * 100 : 0) | number:'1.1-1' }}%</span>
                </span>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>

      <!-- Cards de Destaque -->
      <div class="highlight-cards">
        <!-- Maior Gasto Destacado -->
        <div *ngIf="largestExpense" class="largest-expense-highlight">
        <mat-card class="largest-expense-card-highlight dark-card">
          <mat-card-content>
            <div class="largest-expense-header">
              <div class="header-info">
                <mat-icon class="expense-icon">trending_down</mat-icon>
                <div class="header-text">
                  <h3>Maior Gasto do Mês</h3>
                  <p>Transação de maior valor registrada</p>
                </div>
              </div>
              <div class="expense-amount-large">
                {{ formatCurrency(largestExpense.amount) }}
              </div>
            </div>
            
            <div class="expense-details">
              <div class="expense-main-info">
                <div class="expense-description">
                  <mat-icon>description</mat-icon>
                  <span>{{ largestExpense.description }}</span>
                </div>
                <div class="expense-date">
                  <mat-icon>calendar_today</mat-icon>
                  <span>{{ formatDate(largestExpense.date) }}</span>
                </div>
              </div>
              
              <div class="expense-tags">
                <mat-chip [style.background-color]="getCategoryColor(largestExpense.category)">
                  <mat-icon>category</mat-icon>
                  {{ largestExpense.category }}
                </mat-chip>
                <mat-chip *ngIf="largestExpense.isCreditCard" class="credit-card-chip">
                  <mat-icon>credit_card</mat-icon>
                  Cartão de Crédito
                </mat-chip>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
        </div>

        <!-- Dia que Mais Gastou -->
        <div *ngIf="highestExpenseDay" class="highest-day-highlight">
          <mat-card class="highest-day-card-highlight dark-card">
            <mat-card-content>
              <div class="highest-day-header">
                <div class="header-info">
                  <mat-icon class="day-icon">calendar_view_day</mat-icon>
                  <div class="header-text">
                    <h3>Dia que Mais Gastou</h3>
                    <p>{{ highestExpenseDay.transactionCount }} transação(ões) neste dia</p>
                  </div>
                </div>
                <div class="day-amount-large">
                  {{ formatCurrency(highestExpenseDay.totalExpenses) }}
                </div>
              </div>
              
              <div class="day-details">
                <div class="day-main-info">
                  <div class="day-date">
                    <mat-icon>event</mat-icon>
                    <span>{{ formatDate(highestExpenseDay.date) }}</span>
                  </div>
                  <div class="day-stats">
                    <mat-icon>receipt</mat-icon>
                    <span>{{ highestExpenseDay.transactionCount }} gastos</span>
                  </div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>

      <!-- Abas de Informações Detalhadas -->
      <mat-tab-group [(selectedIndex)]="selectedTab" class="info-tabs">
        
        <!-- Aba: Gastos por Categoria -->
        <mat-tab label="Gastos por Categoria">
          <div class="tab-content">
            <!-- Filtro Ativo -->
            <div *ngIf="selectedCategoryFilter" class="active-filter">
              <mat-icon>filter_list</mat-icon>
              <span>Filtrado por: <strong>{{ selectedCategoryFilter }}</strong></span>
              <button mat-icon-button (click)="clearCategoryFilter()" class="clear-filter">
                <mat-icon>close</mat-icon>
              </button>
            </div>

            <mat-card *ngIf="expensesByCategory.length > 0" class="categories-card dark-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>pie_chart</mat-icon>
                  Distribuição dos Gastos
                </mat-card-title>
                <mat-card-subtitle>Clique em uma categoria para filtrar</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <div class="categories-list">
                  <div *ngFor="let category of expensesByCategory" 
                       class="category-item clickable"
                       [class.selected]="selectedCategoryFilter === category.category"
                       (click)="filterByCategory(category.category)">
                    <div class="category-info">
                      <div class="category-color" [style.background-color]="category.color"></div>
                      <span class="category-name">{{ category.category }}</span>
                      <span class="category-percentage">({{ category.percentage | number:'1.1-1' }}%)</span>
                    </div>
                    <div class="category-amount">
                      {{ formatCurrency(category.amount) }}
                    </div>
                    <div class="category-bar">
                      <div class="category-bar-fill" 
                           [style.width.%]="category.percentage" 
                           [style.background-color]="category.color">
                      </div>
                    </div>
                    <mat-icon class="category-arrow">chevron_right</mat-icon>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>

            <div *ngIf="expensesByCategory.length === 0" class="no-data">
              <mat-icon>category</mat-icon>
              <p>Nenhum gasto registrado neste período</p>
            </div>
          </div>
        </mat-tab>

        <!-- Aba: Transações do Mês -->
        <mat-tab label="Transações do Mês">
          <div class="tab-content">
            <!-- Filtro Ativo -->
            <div *ngIf="selectedCategoryFilter" class="active-filter">
              <mat-icon>filter_list</mat-icon>
              <span>Filtrado por: <strong>{{ selectedCategoryFilter }}</strong></span>
              <button mat-icon-button (click)="clearCategoryFilter()" class="clear-filter">
                <mat-icon>close</mat-icon>
              </button>
            </div>

            <mat-card class="transactions-card dark-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>receipt_long</mat-icon>
                  Lista de Transações
                </mat-card-title>
                <div class="card-subtitle">
                  {{ getDisplayTransactions().length }} transação(ões) encontrada(s)
                  <span *ngIf="selectedCategoryFilter"> - {{ selectedCategoryFilter }}</span>
                </div>
              </mat-card-header>
              <mat-card-content>
                <div *ngIf="getDisplayTransactions().length === 0" class="no-transactions">
                  <mat-icon>receipt_long</mat-icon>
                  <p *ngIf="!selectedCategoryFilter">Nenhuma transação encontrada</p>
                  <p *ngIf="selectedCategoryFilter">Nenhuma transação encontrada para {{ selectedCategoryFilter }}</p>
                </div>
                
                <ng-container *ngFor="let transaction of getDisplayTransactions(); let last = last">
                  <div class="transaction-item">
                    <div class="transaction-info">
                      <div class="transaction-main">
                        <span class="transaction-description">{{ transaction.description }}</span>
                        <mat-chip-set>
                          <mat-chip [style.background-color]="getCategoryColor(transaction.category)">
                            {{ transaction.category }}
                          </mat-chip>
                          <mat-chip *ngIf="transaction.isCreditCard" class="credit-card-chip">
                            <mat-icon>credit_card</mat-icon>
                            Cartão
                          </mat-chip>
                        </mat-chip-set>
                      </div>
                      <div class="transaction-meta">
                        <span class="transaction-date">{{ formatDate(transaction.date) }}</span>
                      </div>
                    </div>
                    <div class="transaction-amount" [class]="transaction.amount > 0 ? 'positive' : 'negative'">
                      {{ formatCurrency(transaction.amount) }}
                    </div>
                  </div>
                  
                  <mat-divider *ngIf="!last"></mat-divider>
                </ng-container>
              </mat-card-content>
            </mat-card>
          </div>
        </mat-tab>

        <!-- Aba: Resumo dos Últimos 12 Meses -->
        <mat-tab label="Últimos 12 Meses">
          <div class="tab-content">
            <mat-card class="monthly-summary-card dark-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>timeline</mat-icon>
                  Evolução Mensal
                </mat-card-title>
                <div class="card-subtitle">
                  Comparativo dos últimos 12 meses
                </div>
              </mat-card-header>
              <mat-card-content>
                <div *ngIf="monthlySummaries.length === 0" class="no-data">
                  <mat-icon>timeline</mat-icon>
                  <p>Dados insuficientes para análise</p>
                </div>
                
                <div *ngFor="let summary of monthlySummaries" class="monthly-item">
                  <div class="month-info">
                    <span class="month-name">{{ formatMonthYear(summary.month) }}</span>
                    <span class="transaction-count">{{ summary.transactionCount }} transação(ões)</span>
                  </div>
                  <div class="month-values">
                    <div class="value-item">
                      <span class="label">Receitas:</span>
                      <span class="value positive">{{ formatCurrency(summary.income) }}</span>
                    </div>
                    <div class="value-item">
                      <span class="label">Gastos:</span>
                      <span class="value negative">{{ formatCurrency(summary.expenses) }}</span>
                    </div>
                    <div class="value-item">
                      <span class="label">Saldo:</span>
                      <span class="value" [class]="summary.balance >= 0 ? 'positive' : 'negative'">
                        {{ formatCurrency(summary.balance) }}
                      </span>
                    </div>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </mat-tab>


      </mat-tab-group>
    </div>
  </div>
</div>
